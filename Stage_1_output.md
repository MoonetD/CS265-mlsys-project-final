# Stage 1 Profiler Outputs Explained

This document details the structure and meaning of the CSV files generated by the Stage 1 graph profiler. These files provide essential statistics for analyzing model performance and for implementing Stage 2 (Activation Checkpointing).

The profiler generates two main CSV files for each batch size (e.g., `bs4` for batch size 4):

1.  `profiler_stats_bs<X>_activation_stats.csv`
2.  `profiler_stats_bs<X>_node_stats.csv`

## 1. Activation Statistics (`profiler_stats_bs<X>_activation_stats.csv`)

This file contains detailed metrics for each tensor identified as an "activation" by the profiler. An activation is typically a tensor created during the forward pass and used during the backward pass.

| Column Name             | Description                                                                                                                               | Units         |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `activation_name`       | The unique name assigned to the activation tensor within the PyTorch FX computation graph.                                                | String        |
| `creation_rank`         | The topological rank (execution order index) of the graph node that creates this activation tensor during the forward pass.                 | Integer       |
| `last_fw_use_rank`      | The topological rank of the last node that uses this activation tensor during the forward pass. A value of -1 indicates it's not used further in the forward pass after its creation. | Integer       |
| `first_bw_use_rank`     | The topological rank of the first node that uses this activation tensor during the backward pass. A value of -1 indicates it's not used in the backward pass. | Integer       |
| `last_bw_use_rank`      | The topological rank of the last node that uses this activation tensor during the backward pass. A value of -1 indicates it's not used or only used once in the backward pass. | Integer       |
| `median_mem_size_bytes` | The median memory size of this activation tensor, in bytes, as measured across multiple profiling runs.                                    | Bytes         |
| `inactive_time_s`       | The median duration, in seconds, for which this activation tensor remains in GPU memory between its last use in the forward pass and its first use in the backward pass. This is a key metric for checkpointing decisions. | Seconds       |
| `recomp_time_s`         | The median estimated time, in seconds, required to recompute this activation tensor from its source dependencies if it were not stored.      | Seconds       |
| `recomp_memory_bytes`   | The median peak additional memory, in bytes, that would be required during the recomputation of this specific activation.                   | Bytes         |

## 2. Node Statistics (`profiler_stats_bs<X>_node_stats.csv`)

This file contains metrics for every individual operation (node) in the traced computation graph.

| Column Name                 | Description                                                                                                                                  | Units         |
|-----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|---------------|
| `rank`                      | The topological rank (execution order index) of this node within the entire computation graph (forward, backward, and optimizer steps).      | Integer       |
| `node_name`                 | The unique name assigned to this node within the PyTorch FX computation graph.                                                               | String        |
| `node_type`                 | The profiler's classification of the primary tensor associated with this node (e.g., `parameter`, `activation`, `gradient`, `optimizer_state`, `other`). | Enum String   |
| `gtype`                     | The general phase of the training iteration this node belongs to (e.g., `forward`, `backward`, `optimizer/other`, `unknown`, `intermediate/other`). | Enum String   |
| `median_run_time_s`         | The median execution time of this node, in seconds, as measured across multiple profiling runs.                                                | Seconds       |
| `median_peak_mem_bytes`     | The median peak GPU memory allocated *during* the execution of this specific node, in bytes. This reflects the transient memory usage of the operation itself. | Bytes         |
| `median_active_mem_bytes`   | The median active GPU memory (memory allocated by PyTorch's caching allocator that is currently in use) measured *just before* this node's execution. | Bytes         |
| `device`                    | The device (e.g., `cuda:0`, `cpu`) on which the output tensor of this node resides, if the node produces a tensor. Can be `unknown` if not applicable or indeterminable. | String        |

This information is vital for understanding the performance characteristics of the model and forms the basis for the activation checkpointing algorithm in Stage 2. The `recomp_time_s` in the activation stats, for instance, is derived from the `median_run_time_s` of the nodes that contribute to creating that activation.